local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Sound = ReplicatedStorage:WaitForChild("Sound")
local Image = ReplicatedStorage:WaitForChild("Image")

-- GUI
local Gui = script.Parent.GloveGui
local TextLabel = Gui.TextLabel
local TextBox = Gui.TextBox
local Background = Gui.Background

-- Variables
local AbilityActivated = false
local Cooldown = false
local ImageId = ""

-- Function to play the sound and apply knockback
local function ApplyKnockback(player)
  local char = player.Character
  if char then
    local hum = char:FindFirstChildOfClass("Humanoid")
    if hum then
      local sound = Sound:FindFirstChild(tostring(5058160717))
      sound.Volume = 40
      sound:Play()
      hum.PlatformStand = true
      hum:ChangeState(Enum.HumanoidStateType.Ragdoll)
      wait(2)
      hum.PlatformStand = false
      char:MoveTo(char.HumanoidRootPart.Position - Vector3.new(0, 0, 5))
    end
  end
end

-- Function to display image on knockback
local function DisplayImage(player)
  local screenGui = Instance.new("ScreenGui")
  local imageLabel = Instance.new("ImageLabel")
  imageLabel.Parent = screenGui
  imageLabel.BackgroundTransparency = 1
  imageLabel.Size = UDim2.new(1, 0, 1, 0)
  imageLabel.Image = Image:FindFirstChild(ImageId).Image
  screenGui.Parent = player.PlayerGui
  wait(4)
  screenGui:Destroy()
end

-- Function to activate the ability
local function ActivateAbility()
  if AbilityActivated == false and Cooldown == false then
    AbilityActivated = true
    for _, player in pairs(Players:GetPlayers()) do
      if player ~= LocalPlayer then
        ApplyKnockback(player)
        if ImageId == "" or not Image:FindFirstChild(ImageId) then
          DisplayImage(player)
        else
          DisplayImage(player)
        end
      end
    end
    wait(8)
    AbilityActivated = false
    Cooldown = false
  end
end

-- Keybind to activate the ability
LocalPlayer.KeyDown:Connect(function(key)
  if key == "e" then
    ActivateAbility()
  end
end)

-- Function to change the image on the GUI
TextBox.FocusLost:Connect(function(enterPressed)
  if enterPressed then
    ImageId = TextBox.Text
    TextBox.Text = ""
  end
end)

-- Function to play the airhorn sound and give badge
TextBox.FocusLost:Connect(function(enterPressed)
  if ImageId == "8073107254" then
    local sound = Sound:FindFirstChild(tostring(8073107254))
    sound.Volume = 1
    sound:Play()
    wait(5)
    sound:Stop
